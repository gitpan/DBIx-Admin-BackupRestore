<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>C&lt;DBIx::Admin::BackupRestore&gt; - Back-up all tables in a db to XML, and restore them</title>
<link rev="made" href="mailto:" />
</head>

<body style="background-color: white">

<p><a name="__index__"></a></p>
<!-- INDEX BEGIN -->

<ul>

	<li><a href="#name">NAME</a></li>
	<li><a href="#synopsis">Synopsis</a></li>
	<li><a href="#description">Description</a></li>
	<li><a href="#distributions">Distributions</a></li>
	<li><a href="#constructor_and_initialization">Constructor and initialization</a></li>
	<li><a href="#method:_backup($database_name)">Method: <code>backup($database_name)</code></a></li>
	<li><a href="#method:_restore($file_name)">Method: <code>restore($file_name)</code></a></li>
	<li><a href="#example_code">Example code</a></li>
	<li><a href="#related_modules">Related Modules</a></li>
	<li><a href="#required_modules">Required Modules</a></li>
	<li><a href="#changes">Changes</a></li>
	<li><a href="#author">Author</a></li>
	<li><a href="#copyright">Copyright</a></li>
</ul>
<!-- INDEX END -->

<hr />
<p>
</p>
<h1><a name="name">NAME</a></h1>
<p><code>DBIx::Admin::BackupRestore</code> - Back-up all tables in a db to XML, and restore them</p>
<p>
</p>
<hr />
<h1><a name="synopsis">Synopsis</a></h1>
<pre>
        use DBIx::Admin::BackupRestore;</pre>
<pre>
        # Backup.</pre>
<pre>
        open(OUT, &quot;&gt; $file_name&quot;) || die(&quot;Can't open(&gt; $file_name): $!&quot;);
        print OUT DBIx::Admin::BackupRestore -&gt; new(dbh =&gt; $dbh) -&gt; backup('db_name');
        close OUT;</pre>
<pre>
        # Restore.</pre>
<pre>
        DBIx::Admin::BackupRestore -&gt; new(dbh =&gt; $dbh) -&gt; restore($file_name);</pre>
<p>
</p>
<hr />
<h1><a name="description">Description</a></h1>
<p><code>DBIx::Admin::BackupRestore</code> is a pure Perl module.</p>
<p>It exports all data in all tables from one database to an XML file.</p>
<p>Then that file can be imported into another database, possibly under a different database server.</p>
<p>Warning: It is designed on the assumption you have a stand-alone script which creates an appropriate set of empty tables
on the destination database server. You run that script, and then run this module in 'restore' mode.</p>
<p>This module is used almost daily to transfer a MySQL database under MS Windows to a Postgres database under Linux.</p>
<p>Similar modules are discussed below.</p>
<p>
</p>
<hr />
<h1><a name="distributions">Distributions</a></h1>
<p>This module is available both as a Unix-style distro (*.tgz) and an
ActiveState-style distro (*.ppd). The latter is shipped in a *.zip file.</p>
<p>See <a href="http://savage.net.au/Perl-modules.html">http://savage.net.au/Perl-modules.html</a> for details.</p>
<p>See <a href="http://savage.net.au/Perl-modules/html/installing-a-module.html">http://savage.net.au/Perl-modules/html/installing-a-module.html</a> for
help on unpacking and installing each type of distro.</p>
<p>
</p>
<hr />
<h1><a name="constructor_and_initialization">Constructor and initialization</a></h1>
<p><code>new(...)</code> returns a <code>DBIx::Admin::BackupRestore</code> object.</p>
<p>This is the class's contructor.</p>
<p>Usage: DBIx::Admin::BackupRestore -&gt; new().</p>
<p>This method takes a set of parameters. Only the dbh parameter is mandatory.</p>
<p>For each parameter you wish to use, call new as new(param_1 =&gt; value_1, ...).</p>
<dl>
<dt><strong><a name="item_clean">clean</a></strong><br />
</dt>
<dd>
The default value is 0.
</dd>
<dd>
<p>If new is called as new(clean =&gt; 1), the backup phase deletes any characters outside the range 20 .. 7E (hex).</p>
</dd>
<dd>
<p>The restore phase ignores this parameter.</p>
</dd>
<dd>
<p>This parameter is optional.</p>
</dd>
<p></p>
<dt><strong><a name="item_dbh">dbh</a></strong><br />
</dt>
<dd>
This is a database handle.
</dd>
<dd>
<p>This parameter is mandatory.</p>
</dd>
<p></p>
<dt><strong><a name="item_verbose">verbose</a></strong><br />
</dt>
<dd>
The default value is 0.
</dd>
<dd>
<p>If new is called as new(verbose =&gt; 1), the backup and restore phases both print the names of the tables to STDERR.</p>
</dd>
<dd>
<p>When beginning to use this module, you are strongly encouraged to use the verbose option as a progress monitor.</p>
</dd>
<dd>
<p>This parameter is optional.</p>
</dd>
<p></p></dl>
<p>
</p>
<hr />
<h1><a name="method:_backup($database_name)">Method: <code>backup($database_name)</code></a></h1>
<p>Returns a potentially-huge string of XML.</p>
<p>You would normally write this straight to disk.</p>
<p>The database name is passed in here to help decorate the XML.</p>
<p>
</p>
<hr />
<h1><a name="method:_restore($file_name)">Method: <code>restore($file_name)</code></a></h1>
<p>Returns an array ref of imported table names. They are sorted by name.</p>
<p>Opens and reads the given file, presumably one output by a previous call to backup().</p>
<p>If the incoming data is going in to a column of type timestamp, then the data is fiddled in the following manner:</p>
<dl>
<dt><strong><a name="item_data_matching_%2f%5e0000%2f_is_converted_to_197001">Data matching /^0000/ is converted to 19700101</a></strong><br />
</dt>
<dt><strong><a name="item_data_is_converted_to_the_format_yyyy%2dmm%2ddd_00%">Data is converted to the format YYYY-MM-DD 00:00:00</a></strong><br />
</dt>
</dl>
<p>This transformation could easily be make optional. Just ask!</p>
<p>
</p>
<hr />
<h1><a name="example_code">Example code</a></h1>
<p>See the examples/ directory in the distro.</p>
<p>There are 2 demo programs:</p>
<dl>
<dt><strong><a name="item_backup%2ddb%2epl">backup-db.pl</a></strong><br />
</dt>
<dt><strong><a name="item_restore%2ddb%2epl">restore-db.pl</a></strong><br />
</dt>
</dl>
<p>
</p>
<hr />
<h1><a name="related_modules">Related Modules</a></h1>
<p>On CPAN I can see 4 modules which obviously offer similar features - there may be others.</p>
<dl>
<dt><strong><a name="item_dbix%3a%3acopy">DBIx::Copy</a></strong><br />
</dt>
<dt><strong><a name="item_dbix%3a%3adump">DBIx::Dump</a></strong><br />
</dt>
<dt><strong><a name="item_dbix%3a%3amigrate">DBIx::Migrate</a></strong><br />
</dt>
<dt><strong><a name="item_dbix%3a%3axml_rdb">DBIx::XML_RDB</a></strong><br />
</dt>
</dl>
<p>Of these, DBIx::XML_RDB is the only one I have experimented with. My thanks to Matt Sergeant for that module.</p>
<p>I have effectively extended his module to automatically handle all tables, and to handle importing too.</p>
<p>
</p>
<hr />
<h1><a name="required_modules">Required Modules</a></h1>
<p>Carp.</p>
<p>
</p>
<hr />
<h1><a name="changes">Changes</a></h1>
<p>See Changes.txt.</p>
<p>
</p>
<hr />
<h1><a name="author">Author</a></h1>
<p><code>DBIx::Admin::BackupRestore</code> was written by Ron Savage <em>&lt;<a href="mailto:ron@savage.net.au">ron@savage.net.au</a>&gt;</em> in 2004.</p>
<p>Home page: <a href="http://savage.net.au/index.html">http://savage.net.au/index.html</a></p>
<p>
</p>
<hr />
<h1><a name="copyright">Copyright</a></h1>
<p>Australian copyright (c) 2004, Ron Savage. All rights reserved.</p>
<pre>
        All Programs of mine are 'OSI Certified Open Source Software';
        you can redistribute them and/or modify them under the terms of
        The Artistic License, a copy of which is available at:
        <a href="http://www.opensource.org/licenses/index.html">http://www.opensource.org/licenses/index.html</a></pre>

</body>

</html>
